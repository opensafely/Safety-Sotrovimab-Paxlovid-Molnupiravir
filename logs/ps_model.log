-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/ps_model.log
  log type:  text
 opened on:   1 Aug 2023, 14:31:41

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "/usr/local/stata/ado/base/"
  [2]  (SITE)      "/usr/local/ado/"
  [3]              "."
  [4]  (PERSONAL)  "~/ado/personal/"
  [5]  (PLUS)      "~/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/workspace/analysis/ado"

. 
. * SET Index date 
. global indexdate                        = "01/03/2020"

. 
. use "$projectdir/output/data/main", clear

. 
. 
. *Predictors of drug use 
. gen no_drug=1 if drug==0
(1,630 missing values generated)

. replace no_drug=0 if drug >0
(1,630 real changes made)

.                                 
. * Outcome                                                               
. tabstat age sex region_nhs, by(no_drug) statistics(n mean sd) column(statisti
> cs) nototal long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |      1630  48.15583  19.03227
                  sex |      1630   .490184  .5000571
           region_nhs |      1630  4.803067  2.559757
----------------------+------------------------------
1                 age |     24839  49.00757  18.98055
                  sex |     24839  .5137888  .4998199
           region_nhs |     24839  4.814324  2.516486
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |      1630  48.15583  19.03227
                  sex |      1630   .490184  .5000571
           region_nhs |      1630  4.803067  2.559757
         paxlovid_c~d |      1630  .5337423  .4990133
         downs_synd~e |      1630  .1809816  .3851211
         solid_cancer |      1630   .107362  .3096679
         haem_disease |      1630  .4852761  .4999365
         renal_dise~e |      1630  .3527607  .4779757
         liver_dise~e |      1630   .197546  .3982699
         imid_on_drug |      1630  .2239264  .4170012
         immunosupr~n |      1630  .0981595  .2976215
             hiv_aids |      1630  .2190184   .413708
         organ_tran~t |      1630  .3177914  .4657608
           rare_neuro |      1630  .5736196  .4947022
----------------------+------------------------------
1                 age |     24839  49.00757  18.98055
                  sex |     24839  .5137888  .4998199
           region_nhs |     24839  4.814324  2.516486
         paxlovid_c~d |     24839  .5212368  .4995589
         downs_synd~e |     24839  .1885744  .3911781
         solid_cancer |     24839   .098756  .2983401
         haem_disease |     24839  .4674906  .4989521
         renal_dise~e |     24839  .3494505   .476806
         liver_dise~e |     24839  .1908289  .3929624
         imid_on_drug |     24839  .2187689  .4134198
         immunosupr~n |     24839  .1006482  .3008683
             hiv_aids |     24839  .1893796  .3918178
         organ_tran~t |     24839  .3129353  .4636976
           rare_neuro |     24839  .5682596  .4953287
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro ///
>                 vaccination_status imdq5 White, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |      1630  48.15583  19.03227
                  sex |      1630   .490184  .5000571
           region_nhs |      1630  4.803067  2.559757
         paxlovid_c~d |      1630  .5337423  .4990133
         downs_synd~e |      1630  .1809816  .3851211
         solid_cancer |      1630   .107362  .3096679
         haem_disease |      1630  .4852761  .4999365
         renal_dise~e |      1630  .3527607  .4779757
         liver_dise~e |      1630   .197546  .3982699
         imid_on_drug |      1630  .2239264  .4170012
         immunosupr~n |      1630  .0981595  .2976215
             hiv_aids |      1630  .2190184   .413708
         organ_tran~t |      1630  .3177914  .4657608
           rare_neuro |      1630  .5736196  .4947022
         vaccinat~tus |      1630  2.161963  1.308527
                imdq5 |      1616  3.046411  1.421968
                White |       588         0         0
----------------------+------------------------------
1                 age |     24839  49.00757  18.98055
                  sex |     24839  .5137888  .4998199
           region_nhs |     24839  4.814324  2.516486
         paxlovid_c~d |     24839  .5212368  .4995589
         downs_synd~e |     24839  .1885744  .3911781
         solid_cancer |     24839   .098756  .2983401
         haem_disease |     24839  .4674906  .4989521
         renal_dise~e |     24839  .3494505   .476806
         liver_dise~e |     24839  .1908289  .3929624
         imid_on_drug |     24839  .2187689  .4134198
         immunosupr~n |     24839  .1006482  .3008683
             hiv_aids |     24839  .1893796  .3918178
         organ_tran~t |     24839  .3129353  .4636976
           rare_neuro |     24839  .5682596  .4953287
         vaccinat~tus |     24839  2.194774  1.328664
                imdq5 |     24565  3.032689  1.413044
                White |      8887         0         0
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro ///
>                 vaccination_status imdq5 White bmi_group diabetes chronic_car
> diac_disease chronic_respiratory_disease hypertension, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |      1630  48.15583  19.03227
                  sex |      1630   .490184  .5000571
           region_nhs |      1630  4.803067  2.559757
         paxlovid_c~d |      1630  .5337423  .4990133
         downs_synd~e |      1630  .1809816  .3851211
         solid_cancer |      1630   .107362  .3096679
         haem_disease |      1630  .4852761  .4999365
         renal_dise~e |      1630  .3527607  .4779757
         liver_dise~e |      1630   .197546  .3982699
         imid_on_drug |      1630  .2239264  .4170012
         immunosupr~n |      1630  .0981595  .2976215
             hiv_aids |      1630  .2190184   .413708
         organ_tran~t |      1630  .3177914  .4657608
           rare_neuro |      1630  .5736196  .4947022
         vaccinat~tus |      1630  2.161963  1.308527
                imdq5 |      1616  3.046411  1.421968
                White |       588         0         0
            bmi_group |      1528  1.942408    1.0252
             diabetes |      1630  .1042945   .305736
         chronic_ca~e |      1630   .095092   .293432
         chronic_re~e |      1630   .108589  .3112183
         hypertension |      1630   .098773  .2984486
----------------------+------------------------------
1                 age |     24839  49.00757  18.98055
                  sex |     24839  .5137888  .4998199
           region_nhs |     24839  4.814324  2.516486
         paxlovid_c~d |     24839  .5212368  .4995589
         downs_synd~e |     24839  .1885744  .3911781
         solid_cancer |     24839   .098756  .2983401
         haem_disease |     24839  .4674906  .4989521
         renal_dise~e |     24839  .3494505   .476806
         liver_dise~e |     24839  .1908289  .3929624
         imid_on_drug |     24839  .2187689  .4134198
         immunosupr~n |     24839  .1006482  .3008683
             hiv_aids |     24839  .1893796  .3918178
         organ_tran~t |     24839  .3129353  .4636976
           rare_neuro |     24839  .5682596  .4953287
         vaccinat~tus |     24839  2.194774  1.328664
                imdq5 |     24565  3.032689  1.413044
                White |      8887         0         0
            bmi_group |     23324  1.952067  1.037363
             diabetes |     24839  .0999235   .299904
         chronic_ca~e |     24839   .102178  .3028884
         chronic_re~e |     24839    .10093  .3012421
         hypertension |     24839  .1010105  .3013487
-----------------------------------------------------

. 
. tempname coxoutput_propensity

. 
. postfile `coxoutput_propensity' str20(model) ///
>         hr_sot lc_sot uc_sot hr_pax lc_pax uc_pax hr_mol lc_mol uc_mol ///
>         using "$projectdir/output/tables/cox_model_propensity", replace      
>                                    

. 
. * Models
. global agesex   age i.sex

. global adj              age i.sex i.region_nhs paxlovid_contraindicated downs
> _syndrome solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro  

. global fulladj1 age i.sex i.region_nhs paxlovid_contraindicated downs_syndrom
> e solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro  vaccination_status imdq5 White 

. global fulladj2 age i.sex i.region_nhs paxlovid_contraindicated downs_syndrom
> e solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro vaccination_status imdq5 White ///
>                                 1b.bmi_group diabetes chronic_cardiac_disease
>  chronic_respiratory_disease hypertension

.                 
.                                 
. foreach model in agesex adj fulladj1 fulladj2 {
  2.                 logistic no_drug $`model'
  3.                 predict p_`model'
  4.                 twoway  (histogram p_`model' if no_drug==1, color(green)) 
> ///
>                                 (histogram p_`model' if no_drug==0, fcolor(no
> ne) lcolor(black)), ///
>                                 legend(order(1 "No Drug" 2 "Drug")) name(hist
> ogram_`model', replace) ///
>                                 saving("$projectdir/output/figures/histogram_
> `model'", replace)
  5.                 graph export "$projectdir/output/figures/histogram_`model'
> .svg", as(svg) replace
  6.                 gen iptw_`model' = 1/p_`model' if no_drug==1
  7.                 replace iptw_`model' = 1/(1-p_`model') if no_drug==0
  8.                 stset stop_ae_all [pw=iptw_`model'], id(patient_id) origin
> (time start_date) enter(time start_date) failure(fail_ae_all==1) 
  9.                 stcox i.drug, vce(robust)
 10.                                                 matrix b = r(table)
 11.                                                 local hr_sot = b[1,2]
 12.                                                 local lc_sot = b[5,2]
 13.                                                 local uc_sot = b[6,2]
 14.                                                 local hr_pax = b[1,3]
 15.                                                 local lc_pax = b[5,3]
 16.                                                 local uc_pax = b[6,3]
 17.                                                 local hr_mol = b[1,4]
 18.                                                 local lc_mol = b[5,4]
 19.                                                 local uc_mol = b[6,4]
 20.                 post `coxoutput_propensity' ("`model'") (`hr_sot') (`lc_so
> t') (`uc_sot') (`hr_pax') (`lc_pax') (`uc_pax') (`hr_mol') (`lc_mol') (`uc_mo
> l')      
 21. }

Logistic regression                             Number of obs     =     26,469
                                                LR chi2(2)        =       6.40
                                                Prob > chi2       =     0.0407
Log likelihood = -6118.9987                     Pseudo R2         =     0.0005

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   1.002342   .0013581     1.73   0.084     .9996842    1.005008
             |
         sex |
     Female  |   1.097578    .056148     1.82   0.069     .9928672    1.213332
       _cons |   12.98028   .9629966    34.55   0.000     11.22365    15.01185
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(file /workspace/output/figures/histogram_agesex.gph saved)
(note: file /workspace/output/figures/histogram_agesex.svg not found)
(file /workspace/output/figures/histogram_agesex.svg written in SVG format)
(1,630 missing values generated)
(1,630 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_agesex]

------------------------------------------------------------------------------
     26,469  total observations
     23,554  observations end on or before enter()
------------------------------------------------------------------------------
      2,915  observations remaining, representing
      2,915  subjects
      1,143  failures in single-failure-per-subject data
   65,820.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        29

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_agesex]

(sum of wgt is 5,637.28170335293)
Iteration 0:   log pseudolikelihood = -20601.795
Iteration 1:   log pseudolikelihood = -20561.513
Iteration 2:   log pseudolikelihood = -20561.331
Iteration 3:   log pseudolikelihood = -20561.331
Refining estimates:
Iteration 0:   log pseudolikelihood = -20561.331

Cox regression -- Breslow method for ties

No. of subjects      =        5,637             Number of obs    =       2,915
No. of failures      =        2,461
Time at risk         =  122579.3426
                                                Wald chi2(3)     =        9.39
Log pseudolikelihood =   -20561.331             Prob > chi2      =      0.0246

                         (Std. Err. adjusted for 2,915 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   1.536366   .3354679     1.97   0.049      1.00146     2.35698
   paxlovid  |   1.203278   .2273949     0.98   0.327     .8308187    1.742712
molnupira~r  |   1.472309   .2556881     2.23   0.026     1.047552    2.069296
------------------------------------------------------------------------------

Logistic regression                             Number of obs     =     26,469
                                                LR chi2(21)       =      40.89
                                                Prob > chi2       =     0.0058
Log likelihood = -6101.7577                     Pseudo R2         =     0.0033

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   1.002314   .0013585     1.71   0.088      .999655     1.00498
             |
         sex |
     Female  |   1.095017    .056081     1.77   0.076     .9904368     1.21064
             |
  region_nhs |
East Midl..  |   .9451636    .104836    -0.51   0.611     .7604892    1.174684
     London  |   1.076211   .1054211     0.75   0.453     .8882131       1.304
 North East  |   1.225788   .1429964     1.75   0.081     .9752525    1.540685
 North West  |    1.29914   .1547701     2.20   0.028     1.028608    1.640823
 South East  |   .9517857   .1047142    -0.45   0.653     .7671691     1.18083
 South West  |   1.132516   .1295069     1.09   0.276     .9051209    1.417039
West Midl..  |   .8770669   .0957752    -1.20   0.230     .7080795    1.086384
Yorkshire..  |   1.150704   .1322127     1.22   0.222     .9186768    1.441333
             |
paxlovid_c~d |   .9482121    .082084    -0.61   0.539     .8002385    1.123548
downs_synd~e |   1.048118    .069617     0.71   0.479     .9201793    1.193844
solid_cancer |    .909416   .0753806    -1.15   0.252     .7730496    1.069838
haem_disease |   .9314998   .0477211    -1.39   0.166     .8425106    1.029888
renal_dise~e |   .9972439    .055113    -0.05   0.960     .8948691    1.111331
liver_dise~e |   .9883567   .0810517    -0.14   0.886     .8416076    1.160694
imid_on_drug |   .9719627   .0597147    -0.46   0.643     .8616962    1.096339
immunosupr~n |    1.03327   .0888333     0.38   0.703     .8730387    1.222909
    hiv_aids |   .8326239   .0517072    -2.95   0.003     .7372044    .9403939
organ_tran~t |   1.010202   .0818199     0.13   0.900     .8619185    1.183996
  rare_neuro |   .9741239   .0504178    -0.51   0.612     .8801536    1.078127
       _cons |   13.81561   1.655394    21.91   0.000     10.92393    17.47276
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(file /workspace/output/figures/histogram_adj.gph saved)
(note: file /workspace/output/figures/histogram_adj.svg not found)
(file /workspace/output/figures/histogram_adj.svg written in SVG format)
(1,630 missing values generated)
(1,630 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_adj]

------------------------------------------------------------------------------
     26,469  total observations
     23,554  observations end on or before enter()
------------------------------------------------------------------------------
      2,915  observations remaining, representing
      2,915  subjects
      1,143  failures in single-failure-per-subject data
   65,820.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        29

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_adj]

(sum of wgt is 5,617.6177867651)
Iteration 0:   log pseudolikelihood = -20470.183
Iteration 1:   log pseudolikelihood =  -20430.86
Iteration 2:   log pseudolikelihood = -20430.692
Iteration 3:   log pseudolikelihood = -20430.692
Refining estimates:
Iteration 0:   log pseudolikelihood = -20430.692

Cox regression -- Breslow method for ties

No. of subjects      =        5,618             Number of obs    =       2,915
No. of failures      =        2,446
Time at risk         =   122383.614
                                                Wald chi2(3)     =        9.04
Log pseudolikelihood =   -20430.692             Prob > chi2      =      0.0288

                         (Std. Err. adjusted for 2,915 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   1.494243   .3308897     1.81   0.070     .9681188     2.30629
   paxlovid  |   1.185256   .2256226     0.89   0.372     .8161679    1.721254
molnupira~r  |   1.494202    .260017     2.31   0.021     1.062393    2.101518
------------------------------------------------------------------------------
note: White omitted because of collinearity

Logistic regression                             Number of obs     =      9,366
                                                LR chi2(23)       =      38.06
                                                Prob > chi2       =     0.0251
Log likelihood = -2166.9388                     Pseudo R2         =     0.0087

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   1.005573   .0023162     2.41   0.016     1.001043    1.010123
             |
         sex |
     Female  |   1.077531   .0924533     0.87   0.384     .9107429    1.274864
             |
  region_nhs |
East Midl..  |   .9889391   .1845046    -0.06   0.952     .6860606    1.425531
     London  |   1.290411   .2146638     1.53   0.125     .9313821    1.787837
 North East  |   1.156716   .2220597     0.76   0.448     .7939952    1.685138
 North West  |   1.730713   .3640853     2.61   0.009     1.145936    2.613906
 South East  |   .9993501   .1829907    -0.00   0.997     .6979983    1.430807
 South West  |   1.176398   .2236208     0.85   0.393     .8104945    1.707492
West Midl..  |   .8218828   .1458184    -1.11   0.269     .5804833     1.16367
Yorkshire..  |   1.114151    .208305     0.58   0.563     .7723266    1.607264
             |
paxlovid_c~d |   1.070579   .1559989     0.47   0.640     .8046112    1.424462
downs_synd~e |   .9622645   .1056503    -0.35   0.726     .7759579    1.193303
solid_cancer |   .8133182   .1099665    -1.53   0.126     .6239818    1.060105
haem_disease |   .8983441   .0770152    -1.25   0.211     .7593972    1.062714
renal_dise~e |     .97561    .089622    -0.27   0.788     .8148595    1.168072
liver_dise~e |   .8741861   .1186714    -0.99   0.322     .6699658    1.140657
imid_on_drug |   .9316163   .0945847    -0.70   0.485     .7635135     1.13673
immunosupr~n |   1.150859   .1727282     0.94   0.349     .8575682    1.544457
    hiv_aids |   .7806599   .0793556    -2.44   0.015     .6396399    .9527703
organ_tran~t |   .9359151    .126733    -0.49   0.625     .7177523    1.220389
  rare_neuro |   1.016682    .087979     0.19   0.848     .8580764    1.204603
vaccinat~tus |   .9739088   .0318079    -0.81   0.418     .9135198     1.03829
       imdq5 |   1.001041   .0302015     0.03   0.972     .9435634     1.06202
       White |          1  (omitted)
       _cons |    12.1392   2.786673    10.87   0.000     7.740848    19.03671
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(17,103 missing values generated)
(file /workspace/output/figures/histogram_fulladj1.gph saved)
(note: file /workspace/output/figures/histogram_fulladj1.svg not found)
(file /workspace/output/figures/histogram_fulladj1.svg written in SVG format)
(17,687 missing values generated)
(584 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_fulladj1]

------------------------------------------------------------------------------
     26,469  total observations
     23,554  observations end on or before enter()
      1,913  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
      1,002  observations remaining, representing
      1,002  subjects
        412  failures in single-failure-per-subject data
     22,253  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        29

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_fulladj1]

(sum of wgt is 1,939.02155470848)
Iteration 0:   log pseudolikelihood = -6147.7816
Iteration 1:   log pseudolikelihood = -6139.2378
Iteration 2:   log pseudolikelihood = -6139.2036
Iteration 3:   log pseudolikelihood = -6139.2036
Refining estimates:
Iteration 0:   log pseudolikelihood = -6139.2036

Cox regression -- Breslow method for ties

No. of subjects      =        1,939             Number of obs    =       1,002
No. of failures      =          841
Time at risk         =  43370.36029
                                                Wald chi2(3)     =        1.39
Log pseudolikelihood =   -6139.2036             Prob > chi2      =      0.7081

                         (Std. Err. adjusted for 1,002 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .8385302   .3243704    -0.46   0.649      .392868    1.789743
   paxlovid  |   1.268386   .4189193     0.72   0.472     .6639246    2.423171
molnupira~r  |   1.256026    .349056     0.82   0.412     .7285268    2.165469
------------------------------------------------------------------------------
note: White omitted because of collinearity

Logistic regression                             Number of obs     =      8,842
                                                LR chi2(27)       =      38.95
                                                Prob > chi2       =     0.0641
Log likelihood = -2054.1394                     Pseudo R2         =     0.0094

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   1.005922   .0023834     2.49   0.013     1.001261    1.010604
             |
         sex |
     Female  |    1.09781   .0967072     1.06   0.289     .9237278    1.304699
             |
  region_nhs |
East Midl..  |   .9884613   .1870608    -0.06   0.951     .6821416    1.432336
     London  |   1.335323   .2277325     1.70   0.090     .9559128    1.865325
 North East  |   1.215527   .2400899     0.99   0.323     .8253458    1.790166
 North West  |   1.721842   .3680833     2.54   0.011     1.132477    2.617925
 South East  |    1.03926   .1950602     0.21   0.837     .7193842    1.501369
 South West  |   1.227381   .2387696     1.05   0.292     .8382818    1.797085
West Midl..  |   .8507805   .1544124    -0.89   0.373     .5961131    1.214245
Yorkshire..  |     1.1388   .2177111     0.68   0.497     .7829213    1.656443
             |
paxlovid_c~d |   1.089892   .1641616     0.57   0.568     .8112853    1.464175
downs_synd~e |    .960323    .108477    -0.36   0.720     .7696027    1.198307
solid_cancer |   .8269016   .1144917    -1.37   0.170     .6303729    1.084701
haem_disease |   .9438834   .0830734    -0.66   0.512     .7943321    1.121591
renal_dise~e |   1.018165   .0964041     0.19   0.849     .8457124    1.225782
liver_dise~e |    .862092   .1210804    -1.06   0.291     .6546404    1.135284
imid_on_drug |     .91749   .0951797    -0.83   0.406     .7486836    1.124357
immunosupr~n |   1.142327   .1751459     0.87   0.385     .8458255    1.542765
    hiv_aids |   .7649944   .0792568    -2.59   0.010     .6244102    .9372307
organ_tran~t |   .9443278   .1323845    -0.41   0.683     .7174531    1.242945
  rare_neuro |   1.041768    .092405     0.46   0.645     .8755265    1.239575
vaccinat~tus |   .9853979   .0328851    -0.44   0.659     .9230069    1.052006
       imdq5 |   1.000946   .0310268     0.03   0.976     .9419449    1.063642
       White |          1  (omitted)
             |
    diabetes |   1.008892   .1443152     0.06   0.951     .7622299    1.335375
chronic_ca~e |   1.176201    .181724     1.05   0.294     .8689009    1.592183
chronic_re~e |   1.123604   .1706297     0.77   0.443      .834354    1.513129
hypertension |     .90573   .1259673    -0.71   0.477     .6896283    1.189549
       _cons |   10.39543   2.452317     9.93   0.000     6.546981    16.50607
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(17,627 missing values generated)
(file /workspace/output/figures/histogram_fulladj2.gph saved)
(note: file /workspace/output/figures/histogram_fulladj2.svg not found)
(file /workspace/output/figures/histogram_fulladj2.svg written in SVG format)
(18,182 missing values generated)
(555 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_fulladj2]

------------------------------------------------------------------------------
     26,469  total observations
     23,554  observations end on or before enter()
      1,982  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
        933  observations remaining, representing
        933  subjects
        383  failures in single-failure-per-subject data
   20,668.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        29

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_fulladj2]

(sum of wgt is 1,806.55953264236)
Iteration 0:   log pseudolikelihood = -5521.3379
Iteration 1:   log pseudolikelihood = -5509.5737
Iteration 2:   log pseudolikelihood = -5509.4232
Iteration 3:   log pseudolikelihood = -5509.4231
Refining estimates:
Iteration 0:   log pseudolikelihood = -5509.4231

Cox regression -- Breslow method for ties

No. of subjects      =        1,807             Number of obs    =         933
No. of failures      =          762
Time at risk         =  40249.26956
                                                Wald chi2(3)     =        1.45
Log pseudolikelihood =   -5509.4231             Prob > chi2      =      0.6932

                           (Std. Err. adjusted for 933 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .6971539   .3277795    -0.77   0.443     .2774093    1.752009
   paxlovid  |   1.236392   .4272442     0.61   0.539     .6280831    2.433856
molnupira~r  |   1.218056   .3454807     0.70   0.487     .6986163    2.123714
------------------------------------------------------------------------------

. 
. postclose `coxoutput_propensity'

. 
. pbalchk no_drug age sex region_nhs

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.01              48.16                0.045
         sex |            0.51               0.49                0.047
  region_nhs |            4.81               4.80                0.004
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs, wt(iptw_agesex) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           48.96              48.95                0.000
         sex |            0.51               0.51                0.001
  region_nhs |            4.81               4.81                0.002
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_agesex.svg", as(svg) replace
(note: file /workspace/output/figures/match_agesex.svg not found)
(file /workspace/output/figures/match_agesex.svg written in SVG format)

. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.01              48.16                0.045
         sex |            0.51               0.49                0.047
  region_nhs |            4.81               4.80                0.004
paxlovid_c~d |            0.52               0.53               -0.025
downs_synd~e |            0.19               0.18                0.020
solid_cancer |            0.10               0.11               -0.028
haem_disease |            0.47               0.49               -0.036
renal_dise~e |            0.35               0.35               -0.007
liver_dise~e |            0.19               0.20               -0.017
imid_on_drug |            0.22               0.22               -0.012
immunosupr~n |            0.10               0.10                0.008
    hiv_aids |            0.19               0.22               -0.074
organ_tran~t |            0.31               0.32               -0.010
  rare_neuro |            0.57               0.57               -0.011
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro, ///
> wt(iptw_adj) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           48.95              48.85                0.006
         sex |            0.51               0.51                0.001
  region_nhs |            4.81               4.83               -0.006
paxlovid_c~d |            0.52               0.52                0.004
downs_synd~e |            0.19               0.19                0.000
solid_cancer |            0.10               0.10               -0.002
haem_disease |            0.47               0.47                0.004
renal_dise~e |            0.35               0.35                0.003
liver_dise~e |            0.19               0.19                0.001
imid_on_drug |            0.22               0.22               -0.001
immunosupr~n |            0.10               0.10               -0.004
    hiv_aids |            0.19               0.19                0.002
organ_tran~t |            0.31               0.31                0.011
  rare_neuro |            0.57               0.57               -0.000
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_adj.svg", as(svg) replace 
(note: file /workspace/output/figures/match_adj.svg not found)
(file /workspace/output/figures/match_adj.svg written in SVG format)

. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.01              48.19                0.043
         sex |            0.51               0.49                0.048
  region_nhs |            4.82               4.80                0.006
paxlovid_c~d |            0.52               0.53               -0.025
downs_synd~e |            0.19               0.18                0.019
solid_cancer |            0.10               0.11               -0.028
haem_disease |            0.47               0.49               -0.038
renal_dise~e |            0.35               0.35               -0.010
liver_dise~e |            0.19               0.20               -0.017
imid_on_drug |            0.22               0.22               -0.015
immunosupr~n |            0.10               0.10                0.007
    hiv_aids |            0.19               0.22               -0.075
organ_tran~t |            0.31               0.32               -0.011
  rare_neuro |            0.57               0.57               -0.011
vaccinat~tus |            2.20               2.16                0.028
       imdq5 |            3.03               3.05               -0.010
----------------------------------------------------------------------


. //pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome 
> solid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupr
> ession hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White, /
> //
. //wt(iptw_fulladj1) graph
. //graph export "$projectdir/output/figures/match_fulladj1.svg", as(svg) repla
> ce
. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White ///
> bmi_group diabetes chronic_cardiac_disease chronic_respiratory_disease hypert
> ension     

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.10              47.03                0.111
         sex |            0.51               0.49                0.053
  region_nhs |            4.85               4.93               -0.029
paxlovid_c~d |            0.53               0.53               -0.002
downs_synd~e |            0.18               0.19               -0.013
solid_cancer |            0.10               0.12               -0.056
haem_disease |            0.47               0.49               -0.031
renal_dise~e |            0.36               0.35                0.009
liver_dise~e |            0.19               0.20               -0.040
imid_on_drug |            0.22               0.24               -0.035
immunosupr~n |            0.10               0.09                0.034
    hiv_aids |            0.19               0.24               -0.109
organ_tran~t |            0.32               0.32                0.000
  rare_neuro |            0.57               0.56                0.022
vaccinat~tus |            2.19               2.21               -0.013
       imdq5 |            3.05               3.04                0.006
       White |            0.00               0.00                    .
   bmi_group |            1.95               1.98               -0.031
    diabetes |            0.10               0.11               -0.005
chronic_ca~e |            0.10               0.09                0.045
chronic_re~e |            0.10               0.09                0.036
hypertension |            0.10               0.11               -0.031
----------------------------------------------------------------------


. //pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome 
> solid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupr
> ession hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White //
> /
. //bmi_group diabetes chronic_cardiac_disease chronic_respiratory_disease hype
> rtension, ///
. //wt(iptw_fulladj2) graph
. //graph export "$projectdir/output/figures/match_fulladj2.svg", as(svg) repla
> ce
. 
. use "$projectdir/output/tables/cox_model_propensity", replace

. export delimited using "$projectdir/output/tables/cox_model_propensity_csv.cs
> v", replace
(note: file /workspace/output/tables/cox_model_propensity_csv.csv not found)
file /workspace/output/tables/cox_model_propensity_csv.csv saved

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/ps_model.log
  log type:  text
 closed on:   1 Aug 2023, 14:31:50
-------------------------------------------------------------------------------

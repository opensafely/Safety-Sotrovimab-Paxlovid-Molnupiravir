-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/ps_model.log
  log type:  text
 opened on:  19 Jun 2023, 10:52:44

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "/usr/local/stata/ado/base/"
  [2]  (SITE)      "/usr/local/ado/"
  [3]              "."
  [4]  (PERSONAL)  "~/ado/personal/"
  [5]  (PLUS)      "~/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/workspace/analysis/ado"

. 
. * SET Index date 
. global indexdate                        = "01/03/2020"

. 
. use "$projectdir/output/data/main", clear

. 
. 
. *Predictors of drug use 
. gen no_drug=1 if drug==0
(14,836 missing values generated)

. replace no_drug=0 if drug >0
(14,836 real changes made)

.                                 
. * Outcome                                                               
. tabstat age sex region_nhs, by(no_drug) statistics(n mean sd) column(statisti
> cs) nototal long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |     14836  49.15348  19.05536
                  sex |     14836  .5174575   .499712
           region_nhs |     14836  4.791858  2.542808
----------------------+------------------------------
1                 age |     40746  48.95987  18.98881
                  sex |     40746  .5108231   .499889
           region_nhs |     40746  4.801257  2.524406
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |     14836  49.15348  19.05536
                  sex |     14836  .5174575   .499712
           region_nhs |     14836  4.791858  2.542808
         paxlovid_c~d |     14836   .522378  .4995158
         downs_synd~e |     14836  .1898086  .3921628
         solid_cancer |     14836  .0983419  .2977864
         haem_disease |     14836  .4726341  .4992674
         renal_dise~e |     14836  .3466568  .4759213
         liver_dise~e |     14836  .1889997  .3915216
         imid_on_drug |     14836  .2193988  .4138532
         immunosupr~n |     14836  .1023187  .3030772
             hiv_aids |     14836  .1887975  .3913609
         organ_tran~t |     14836   .313966  .4641184
           rare_neuro |     14836  .5760313  .4942021
----------------------+------------------------------
1                 age |     40746  48.95987  18.98881
                  sex |     40746  .5108231   .499889
           region_nhs |     40746  4.801257  2.524406
         paxlovid_c~d |     40746  .6835518  .4650958
         downs_synd~e |     40746  .1873313   .390182
         solid_cancer |     40746  .0994208  .2992299
         haem_disease |     40746  .4731017  .4992821
         renal_dise~e |     40746   .342733  .4746289
         liver_dise~e |     40746  .1903009  .3925433
         imid_on_drug |     40746  .2181809   .413016
         immunosupr~n |     40746   .100967  .3012887
             hiv_aids |     40746  .1901782  .3924465
         organ_tran~t |     40746   .314583  .4643553
           rare_neuro |     40746  .5700928  .4950687
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro ///
>                 vaccination_status imdq5 White, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |     14836  49.15348  19.05536
                  sex |     14836  .5174575   .499712
           region_nhs |     14836  4.791858  2.542808
         paxlovid_c~d |     14836   .522378  .4995158
         downs_synd~e |     14836  .1898086  .3921628
         solid_cancer |     14836  .0983419  .2977864
         haem_disease |     14836  .4726341  .4992674
         renal_dise~e |     14836  .3466568  .4759213
         liver_dise~e |     14836  .1889997  .3915216
         imid_on_drug |     14836  .2193988  .4138532
         immunosupr~n |     14836  .1023187  .3030772
             hiv_aids |     14836  .1887975  .3913609
         organ_tran~t |     14836   .313966  .4641184
           rare_neuro |     14836  .5760313  .4942021
         vaccinat~tus |     14836  2.211647  1.323186
                imdq5 |     14669  3.004636  1.402199
                White |      5906  .6036234  .4891858
----------------------+------------------------------
1                 age |     40746  48.95987  18.98881
                  sex |     40746  .5108231   .499889
           region_nhs |     40746  4.801257  2.524406
         paxlovid_c~d |     40746  .6835518  .4650958
         downs_synd~e |     40746  .1873313   .390182
         solid_cancer |     40746  .0994208  .2992299
         haem_disease |     40746  .4731017  .4992821
         renal_dise~e |     40746   .342733  .4746289
         liver_dise~e |     40746  .1903009  .3925433
         imid_on_drug |     40746  .2181809   .413016
         immunosupr~n |     40746   .100967  .3012887
             hiv_aids |     40746  .1901782  .3924465
         organ_tran~t |     40746   .314583  .4643553
           rare_neuro |     40746  .5700928  .4950687
         vaccinat~tus |     40746    2.2024  1.323025
                imdq5 |     40357  3.030701  1.405293
                White |     16273  .6024703  .4894022
-----------------------------------------------------

. tabstat age sex region_nhs paxlovid_contraindicated downs_syndrome solid_canc
> er haem_disease renal_disease ///
>                 liver_disease imid_on_drug immunosupression hiv_aids organ_tr
> ansplant rare_neuro ///
>                 vaccination_status imdq5 White bmi_group diabetes chronic_car
> diac_disease chronic_respiratory_disease hypertension, ///
>                 by(no_drug) statistics(n mean sd) column(statistics) nototal 
> long

no_drug      variable |         N      mean        sd
----------------------+------------------------------
0                 age |     14836  49.15348  19.05536
                  sex |     14836  .5174575   .499712
           region_nhs |     14836  4.791858  2.542808
         paxlovid_c~d |     14836   .522378  .4995158
         downs_synd~e |     14836  .1898086  .3921628
         solid_cancer |     14836  .0983419  .2977864
         haem_disease |     14836  .4726341  .4992674
         renal_dise~e |     14836  .3466568  .4759213
         liver_dise~e |     14836  .1889997  .3915216
         imid_on_drug |     14836  .2193988  .4138532
         immunosupr~n |     14836  .1023187  .3030772
             hiv_aids |     14836  .1887975  .3913609
         organ_tran~t |     14836   .313966  .4641184
           rare_neuro |     14836  .5760313  .4942021
         vaccinat~tus |     14836  2.211647  1.323186
                imdq5 |     14669  3.004636  1.402199
                White |      5906  .6036234  .4891858
            bmi_group |     13923  1.960066  1.027694
             diabetes |     14836  .1007684   .301032
         chronic_ca~e |     14836  .1008358  .3011213
         chronic_re~e |     14836  .0999596  .2999562
         hypertension |     14836  .0990159  .2986934
----------------------+------------------------------
1                 age |     40746  48.95987  18.98881
                  sex |     40746  .5108231   .499889
           region_nhs |     40746  4.801257  2.524406
         paxlovid_c~d |     40746  .6835518  .4650958
         downs_synd~e |     40746  .1873313   .390182
         solid_cancer |     40746  .0994208  .2992299
         haem_disease |     40746  .4731017  .4992821
         renal_dise~e |     40746   .342733  .4746289
         liver_dise~e |     40746  .1903009  .3925433
         imid_on_drug |     40746  .2181809   .413016
         immunosupr~n |     40746   .100967  .3012887
             hiv_aids |     40746  .1901782  .3924465
         organ_tran~t |     40746   .314583  .4643553
           rare_neuro |     40746  .5700928  .4950687
         vaccinat~tus |     40746    2.2024  1.323025
                imdq5 |     40357  3.030701  1.405293
                White |     16273  .6024703  .4894022
            bmi_group |     38311  1.970609  1.026596
             diabetes |     40746  .0987336  .2983077
         chronic_ca~e |     40746    .09866  .2982086
         chronic_re~e |     40746  .1002798  .3003764
         hypertension |     40746  .1027095  .3035828
-----------------------------------------------------

. 
. tempname coxoutput_propensity

. 
. postfile `coxoutput_propensity' str20(model) ///
>         hr_sot lc_sot uc_sot hr_pax lc_pax uc_pax hr_mol lc_mol uc_mol ///
>         using "$projectdir/output/tables/cox_model_propensity", replace      
>                                    
(note: file /workspace/output/tables/cox_model_propensity.dta not found)

. 
. * Models
. global agesex   age i.sex

. global adj              age i.sex i.region_nhs paxlovid_contraindicated downs
> _syndrome solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro  

. global fulladj1 age i.sex i.region_nhs paxlovid_contraindicated downs_syndrom
> e solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro  vaccination_status imdq5 White 

. global fulladj2 age i.sex i.region_nhs paxlovid_contraindicated downs_syndrom
> e solid_cancer haem_disease renal_disease ///
>                                 liver_disease imid_on_drug immunosupression h
> iv_aids organ_transplant rare_neuro vaccination_status imdq5 White ///
>                                 1b.bmi_group diabetes chronic_cardiac_disease
>  chronic_respiratory_disease hypertension

.                 
.                                 
. foreach model in agesex adj fulladj1 fulladj2 {
  2.                 logistic no_drug $`model'
  3.                 predict p_`model'
  4.                 twoway  (histogram p_`model' if no_drug==1, color(green)) 
> ///
>                                 (histogram p_`model' if no_drug==0, fcolor(no
> ne) lcolor(black)), ///
>                                 legend(order(1 "No Drug" 2 "Drug")) name(hist
> ogram_`model', replace) ///
>                                 saving("$projectdir/output/figures/histogram_
> `model'", replace)
  5.                 graph export "$projectdir/output/figures/histogram_`model'
> .svg", as(svg) replace
  6.                 gen iptw_`model' = 1/p_`model' if no_drug==1
  7.                 replace iptw_`model' = 1/(1-p_`model') if no_drug==0
  8.                 stset stop_ae_all [pw=iptw_`model'], id(patient_id) origin
> (time start_date) enter(time start_date) failure(fail_ae_all==1) 
  9.                 stcox i.drug, vce(robust)
 10.                                                 matrix b = r(table)
 11.                                                 local hr_sot = b[1,2]
 12.                                                 local lc_sot = b[5,2]
 13.                                                 local uc_sot = b[6,2]
 14.                                                 local hr_pax = b[1,3]
 15.                                                 local lc_pax = b[5,3]
 16.                                                 local uc_pax = b[6,3]
 17.                                                 local hr_mol = b[1,4]
 18.                                                 local lc_mol = b[5,4]
 19.                                                 local uc_mol = b[6,4]
 20.                 post `coxoutput_propensity' ("`model'") (`hr_sot') (`lc_so
> t') (`uc_sot') (`hr_pax') (`lc_pax') (`uc_pax') (`hr_mol') (`lc_mol') (`uc_mo
> l')      
 21. }

Logistic regression                             Number of obs     =     55,582
                                                LR chi2(2)        =       3.04
                                                Prob > chi2       =     0.2187
Log likelihood = -32245.613                     Pseudo R2         =     0.0000

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .9994654    .000504    -1.06   0.289     .9984782    1.000454
             |
         sex |
     Female  |   .9738158   .0186853    -1.38   0.167     .9378735    1.011136
       _cons |    2.85815   .0809523    37.08   0.000      2.70381    3.021301
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(note: file /workspace/output/figures/histogram_agesex.gph not found)
(file /workspace/output/figures/histogram_agesex.gph saved)
(note: file /workspace/output/figures/histogram_agesex.svg not found)
(file /workspace/output/figures/histogram_agesex.svg written in SVG format)
(14,836 missing values generated)
(14,836 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_agesex]

------------------------------------------------------------------------------
     55,582  total observations
     14,583  ignored because never entered
     36,272  observations end on or before enter()
------------------------------------------------------------------------------
      4,727  observations remaining, representing
      4,727  subjects
      3,651  failures in single-failure-per-subject data
  195,835.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       355

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_agesex]

(sum of wgt is 10,649.5059868097)
Iteration 0:   log pseudolikelihood = -54475.179
Iteration 1:   log pseudolikelihood = -54473.196
Iteration 2:   log pseudolikelihood = -54473.195
Refining estimates:
Iteration 0:   log pseudolikelihood = -54473.195

Cox regression -- Breslow method for ties

No. of subjects      =       10,650             Number of obs    =       4,727
No. of failures      =        6,619
Time at risk         =  359251.3354
                                                Wald chi2(3)     =        1.53
Log pseudolikelihood =   -54473.195             Prob > chi2      =      0.6753

                         (Std. Err. adjusted for 4,727 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .9661096   .0691331    -0.48   0.630     .8396841     1.11157
   paxlovid  |   .9626826   .0667321    -0.55   0.583      .840386    1.102776
molnupira~r  |    .919516   .0671562    -1.15   0.251      .796879    1.061026
------------------------------------------------------------------------------

Logistic regression                             Number of obs     =     55,582
                                                LR chi2(21)       =    2150.19
                                                Prob > chi2       =     0.0000
Log likelihood = -31172.037                     Pseudo R2         =     0.0333

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .9994902   .0005134    -0.99   0.321     .9984844    1.000497
             |
         sex |
     Female  |    .974573   .0190593    -1.32   0.188     .9379243    1.012654
             |
  region_nhs |
East Midl..  |   1.032042   .0448163     0.73   0.468     .9478379    1.123727
     London  |   1.032148   .0385346     0.85   0.397     .9593184    1.110506
 North East  |   1.087032   .0475939     1.91   0.057     .9976398    1.184434
 North West  |   1.045479   .0451369     1.03   0.303     .9606517    1.137796
 South East  |   1.040986   .0449757     0.93   0.353      .956464    1.132976
 South West  |   1.093638   .0477196     2.05   0.040     1.003997    1.191283
West Midl..  |   1.037604   .0450234     0.85   0.395     .9530076    1.129709
Yorkshire..  |   1.012916   .0434904     0.30   0.765     .9311642    1.101845
             |
paxlovid_c~d |   3.546728    .101802    44.11   0.000     3.352708    3.751975
downs_synd~e |   .9861223   .0246114    -0.56   0.576     .9390457    1.035559
solid_cancer |   1.016038   .0332894     0.49   0.627     .9528429    1.083425
haem_disease |   1.001116   .0195981     0.06   0.955     .9634325    1.040274
renal_dise~e |   .8486514   .0176758    -7.88   0.000     .8147051    .8840122
liver_dise~e |   .5582246   .0159477   -20.41   0.000     .5278267    .5903732
imid_on_drug |    .992197   .0234468    -0.33   0.740     .9472902    1.039233
immunosupr~n |   .9981761   .0322363    -0.06   0.955     .9369522      1.0634
    hiv_aids |   1.012292   .0252549     0.49   0.624     .9639845    1.063021
organ_tran~t |   .4892052    .013385   -26.13   0.000     .4636621    .5161555
  rare_neuro |   .9718633   .0192106    -1.44   0.149     .9349312    1.010254
       _cons |   1.931433   .0888367    14.31   0.000     1.764934    2.113639
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(note: file /workspace/output/figures/histogram_adj.gph not found)
(file /workspace/output/figures/histogram_adj.gph saved)
(note: file /workspace/output/figures/histogram_adj.svg not found)
(file /workspace/output/figures/histogram_adj.svg written in SVG format)
(14,836 missing values generated)
(14,836 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_adj]

------------------------------------------------------------------------------
     55,582  total observations
     14,583  ignored because never entered
     36,272  observations end on or before enter()
------------------------------------------------------------------------------
      4,727  observations remaining, representing
      4,727  subjects
      3,651  failures in single-failure-per-subject data
  195,835.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       355

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_adj]

(sum of wgt is 10,798.550427556)
Iteration 0:   log pseudolikelihood = -55793.572
Iteration 1:   log pseudolikelihood = -55789.316
Iteration 2:   log pseudolikelihood = -55789.315
Refining estimates:
Iteration 0:   log pseudolikelihood = -55789.315

Cox regression -- Breslow method for ties

No. of subjects      =       10,799             Number of obs    =       4,727
No. of failures      =        6,774
Time at risk         =    369409.24
                                                Wald chi2(3)     =        2.85
Log pseudolikelihood =   -55789.315             Prob > chi2      =      0.4159

                         (Std. Err. adjusted for 4,727 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .9862024   .0736351    -0.19   0.852     .8519435    1.141619
   paxlovid  |    .919965     .06684    -1.15   0.251     .7978611    1.060755
molnupira~r  |   .9000409   .0686392    -1.38   0.167      .775082    1.045146
------------------------------------------------------------------------------

Logistic regression                             Number of obs     =     21,954
                                                LR chi2(24)       =     843.34
                                                Prob > chi2       =     0.0000
Log likelihood = -12289.102                     Pseudo R2         =     0.0332

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .9994445   .0008173    -0.68   0.497     .9978439    1.001048
             |
         sex |
     Female  |   .9302213   .0290029    -2.32   0.020     .8750787    .9888387
             |
  region_nhs |
East Midl..  |   1.036427   .0722896     0.51   0.608     .9039999    1.188253
     London  |   1.026013   .0614407     0.43   0.668     .9123903    1.153787
 North East  |   1.031726   .0715079     0.45   0.652     .9006756    1.181844
 North West  |   1.109774   .0766037     1.51   0.131     .9693463    1.270544
 South East  |   1.029478    .071503     0.42   0.676     .8984551    1.179608
 South West  |   1.100545   .0769407     1.37   0.171     .9596198    1.262167
West Midl..  |   .9770339   .0676027    -0.34   0.737     .8531266    1.118937
Yorkshire..  |   .9841197   .0670797    -0.23   0.814     .8610497     1.12478
             |
paxlovid_c~d |   3.472524   .1584494    27.28   0.000     3.175451    3.797389
downs_synd~e |   .9359494   .0370915    -1.67   0.095     .8660031    1.011545
solid_cancer |   .9597147    .049278    -0.80   0.423     .8678325    1.061325
haem_disease |   1.047932   .0327276     1.50   0.134     .9857106     1.11408
renal_dise~e |   .8299046   .0274901    -5.63   0.000     .7777368    .8855718
liver_dise~e |   .5930429   .0271234   -11.42   0.000     .5421951    .6486593
imid_on_drug |   .9499496   .0353963    -1.38   0.168     .8830469    1.021921
immunosupr~n |   1.005503   .0516085     0.11   0.915     .9092734    1.111916
    hiv_aids |   1.020712   .0405443     0.52   0.606      .944261    1.103352
organ_tran~t |   .5022865    .021929   -15.77   0.000      .461094    .5471589
  rare_neuro |    1.00967   .0317547     0.31   0.760      .949311    1.073866
vaccinat~tus |   1.001027   .0117791     0.09   0.931     .9782043    1.024382
       imdq5 |    1.01283   .0112546     1.15   0.251     .9910101    1.035131
       White |   .9878027   .0314747    -0.39   0.700     .9280002    1.051459
       _cons |   1.914987   .1666698     7.46   0.000     1.614663     2.27117
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(33,628 missing values generated)
(note: file /workspace/output/figures/histogram_fulladj1.gph not found)
(file /workspace/output/figures/histogram_fulladj1.gph saved)
(note: file /workspace/output/figures/histogram_fulladj1.svg not found)
(file /workspace/output/figures/histogram_fulladj1.svg written in SVG format)
(39,462 missing values generated)
(5,834 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_fulladj1]

------------------------------------------------------------------------------
     55,582  total observations
     14,583  ignored because never entered
     36,272  observations end on or before enter()
      2,883  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
      1,844  observations remaining, representing
      1,844  subjects
      1,430  failures in single-failure-per-subject data
   76,320.5  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       317

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_fulladj1]

(sum of wgt is 4,242.97541320324)
Iteration 0:   log pseudolikelihood = -19727.898
Iteration 1:   log pseudolikelihood =     -19721
Iteration 2:   log pseudolikelihood =  -19720.98
Iteration 3:   log pseudolikelihood =  -19720.98
Refining estimates:
Iteration 0:   log pseudolikelihood =  -19720.98

Cox regression -- Breslow method for ties

No. of subjects      =        4,243             Number of obs    =       1,844
No. of failures      =        2,696
Time at risk         =  144181.0275
                                                Wald chi2(3)     =        3.46
Log pseudolikelihood =    -19720.98             Prob > chi2      =      0.3266

                         (Std. Err. adjusted for 1,844 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .9500382   .1153259    -0.42   0.673     .7488814    1.205228
   paxlovid  |   .8763328   .1007716    -1.15   0.251     .6994995     1.09787
molnupira~r  |   1.148569    .131336     1.21   0.226     .9179615     1.43711
------------------------------------------------------------------------------

Logistic regression                             Number of obs     =     20,629
                                                LR chi2(28)       =     798.73
                                                Prob > chi2       =     0.0000
Log likelihood = -11538.268                     Pseudo R2         =     0.0335

------------------------------------------------------------------------------
     no_drug | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         age |   .9994304   .0008454    -0.67   0.501     .9977748    1.001089
             |
         sex |
     Female  |   .9154988   .0294719    -2.74   0.006     .8595196    .9751239
             |
  region_nhs |
East Midl..  |   1.041322   .0747084     0.56   0.572     .9047255    1.198543
     London  |   1.057707   .0653213     0.91   0.364      .937125    1.193806
 North East  |   1.053816   .0752778     0.73   0.463     .9161367    1.212185
 North West  |   1.143506   .0815798     1.88   0.060     .9942879    1.315118
 South East  |    1.03666   .0741882     0.50   0.615     .9009912    1.192758
 South West  |   1.119833   .0805996     1.57   0.116     .9724971    1.289491
West Midl..  |   .9945689   .0709229    -0.08   0.939     .8648395    1.143758
Yorkshire..  |   1.011636   .0712133     0.16   0.869     .8812608    1.161298
             |
paxlovid_c~d |   3.473813   .1635629    26.45   0.000     3.167583    3.809649
downs_synd~e |   .9293464   .0379618    -1.79   0.073     .8578431     1.00681
solid_cancer |   .9591796   .0509053    -0.79   0.432     .8644208    1.064326
haem_disease |   1.050963   .0338777     1.54   0.123     .9866181    1.119504
renal_dise~e |   .8225231    .028127    -5.71   0.000      .769202    .8795405
liver_dise~e |   .5949777   .0281003   -10.99   0.000     .5423743     .652683
imid_on_drug |   .9481131   .0363898    -1.39   0.165     .8794071    1.022187
immunosupr~n |   .9818853   .0517612    -0.35   0.729     .8855002    1.088762
    hiv_aids |   1.030854   .0423464     0.74   0.459     .9511097    1.117284
organ_tran~t |   .4998668   .0225165   -15.39   0.000     .4576272    .5460051
  rare_neuro |   1.014595   .0329487     0.45   0.655     .9520288    1.081273
vaccinat~tus |   1.001185   .0121717     0.10   0.922     .9776111    1.025328
       imdq5 |   1.009716   .0115997     0.84   0.400     .9872354    1.032709
       White |   .9815794   .0323046    -0.56   0.572     .9202624    1.046982
             |
    diabetes |   .9338014   .0491231    -1.30   0.193     .8423191    1.035219
chronic_ca~e |   1.000349    .053443     0.01   0.995     .9008999    1.110776
chronic_re~e |   .9774875   .0521313    -0.43   0.669     .8804707    1.085194
hypertension |    1.00291   .0534597     0.05   0.957     .9034182    1.113358
       _cons |   1.943664   .1757866     7.35   0.000     1.627937    2.320623
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.
(option pr assumed; Pr(no_drug))
(34,953 missing values generated)
(note: file /workspace/output/figures/histogram_fulladj2.gph not found)
(file /workspace/output/figures/histogram_fulladj2.gph saved)
(note: file /workspace/output/figures/histogram_fulladj2.svg not found)
(file /workspace/output/figures/histogram_fulladj2.svg written in SVG format)
(40,429 missing values generated)
(5,476 real changes made)

                id:  patient_id
     failure event:  fail_ae_all == 1
obs. time interval:  (stop_ae_all[_n-1], stop_ae_all]
 enter on or after:  time start_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time start_date
            weight:  [pweight=iptw_fulladj2]

------------------------------------------------------------------------------
     55,582  total observations
     14,583  ignored because never entered
     36,272  observations end on or before enter()
      2,994  weights invalid                                    PROBABLE ERROR
------------------------------------------------------------------------------
      1,733  observations remaining, representing
      1,733  subjects
      1,346  failures in single-failure-per-subject data
     72,289  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       317

         failure _d:  fail_ae_all == 1
   analysis time _t:  (stop_ae_all-origin)
             origin:  time start_date
  enter on or after:  time start_date
                 id:  patient_id
             weight:  [pweight=iptw_fulladj2]

(sum of wgt is 3,976.55895340443)
Iteration 0:   log pseudolikelihood =  -18347.11
Iteration 1:   log pseudolikelihood = -18340.918
Iteration 2:   log pseudolikelihood = -18340.895
Iteration 3:   log pseudolikelihood = -18340.895
Refining estimates:
Iteration 0:   log pseudolikelihood = -18340.895

Cox regression -- Breslow method for ties

No. of subjects      =        3,977             Number of obs    =       1,733
No. of failures      =        2,532
Time at risk         =  136087.9436
                                                Wald chi2(3)     =        3.17
Log pseudolikelihood =   -18340.895             Prob > chi2      =      0.3664

                         (Std. Err. adjusted for 1,733 clusters in patient_id)
------------------------------------------------------------------------------
             |               Robust
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        drug |
 sotrovimab  |   .9590864   .1219304    -0.33   0.742     .7475547    1.230474
   paxlovid  |   .9078119   .1065543    -0.82   0.410     .7212507     1.14263
molnupira~r  |   1.177445   .1389983     1.38   0.166     .9342341    1.483972
------------------------------------------------------------------------------

. 
. postclose `coxoutput_propensity'

. 
. pbalchk no_drug age sex region_nhs

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           48.96              49.15               -0.010
         sex |            0.51               0.52               -0.013
  region_nhs |            4.80               4.79                0.004
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs, wt(iptw_agesex) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.01              49.01                0.000
         sex |            0.51               0.51               -0.000
  region_nhs |            4.80               4.79                0.004
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_agesex.svg", as(svg) replace
(note: file /workspace/output/figures/match_agesex.svg not found)
(file /workspace/output/figures/match_agesex.svg written in SVG format)

. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           48.96              49.15               -0.010
         sex |            0.51               0.52               -0.013
  region_nhs |            4.80               4.79                0.004
paxlovid_c~d |            0.68               0.52                0.334
downs_synd~e |            0.19               0.19               -0.006
solid_cancer |            0.10               0.10                0.004
haem_disease |            0.47               0.47                0.001
renal_dise~e |            0.34               0.35               -0.008
liver_dise~e |            0.19               0.19                0.003
imid_on_drug |            0.22               0.22               -0.003
immunosupr~n |            0.10               0.10               -0.004
    hiv_aids |            0.19               0.19                0.004
organ_tran~t |            0.31               0.31                0.001
  rare_neuro |            0.57               0.58               -0.012
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro, ///
> wt(iptw_adj) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.01              49.02               -0.000
         sex |            0.51               0.51                0.001
  region_nhs |            4.80               4.80               -0.001
paxlovid_c~d |            0.64               0.64                0.011
downs_synd~e |            0.19               0.19                0.000
solid_cancer |            0.10               0.10                0.003
haem_disease |            0.47               0.47                0.004
renal_dise~e |            0.35               0.36               -0.039
liver_dise~e |            0.19               0.20               -0.031
imid_on_drug |            0.22               0.22                0.005
immunosupr~n |            0.10               0.10               -0.003
    hiv_aids |            0.19               0.19                0.001
organ_tran~t |            0.32               0.33               -0.025
  rare_neuro |            0.57               0.57               -0.001
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_adj.svg", as(svg) replace 
(note: file /workspace/output/figures/match_adj.svg not found)
(file /workspace/output/figures/match_adj.svg written in SVG format)

. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.09              49.27               -0.009
         sex |            0.50               0.52               -0.037
  region_nhs |            4.81               4.82               -0.004
paxlovid_c~d |            0.68               0.52                0.339
downs_synd~e |            0.18               0.19               -0.029
solid_cancer |            0.10               0.10               -0.017
haem_disease |            0.47               0.46                0.020
renal_dise~e |            0.34               0.35               -0.020
liver_dise~e |            0.19               0.18                0.023
imid_on_drug |            0.22               0.23               -0.022
immunosupr~n |            0.10               0.10               -0.002
    hiv_aids |            0.19               0.19                0.005
organ_tran~t |            0.32               0.31                0.010
  rare_neuro |            0.57               0.57                0.003
vaccinat~tus |            2.20               2.20               -0.000
       imdq5 |            3.03               3.00                0.023
       White |            0.60               0.60               -0.003
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White, ///
> wt(iptw_fulladj1) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.14              49.17               -0.001
         sex |            0.51               0.51                0.002
  region_nhs |            4.81               4.82               -0.003
paxlovid_c~d |            0.64               0.63                0.010
downs_synd~e |            0.19               0.18                0.005
solid_cancer |            0.10               0.10                0.006
haem_disease |            0.47               0.47                0.001
renal_dise~e |            0.35               0.36               -0.037
liver_dise~e |            0.19               0.20               -0.033
imid_on_drug |            0.22               0.22                0.003
immunosupr~n |            0.10               0.10               -0.002
    hiv_aids |            0.19               0.19               -0.004
organ_tran~t |            0.32               0.33               -0.025
  rare_neuro |            0.57               0.57                0.002
vaccinat~tus |            2.20               2.20                0.004
       imdq5 |            3.02               3.02                0.001
       White |            0.60               0.60               -0.000
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_fulladj1.svg", as(svg) replace
(note: file /workspace/output/figures/match_fulladj1.svg not found)
(file /workspace/output/figures/match_fulladj1.svg written in SVG format)

. 
. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White ///
> bmi_group diabetes chronic_cardiac_disease chronic_respiratory_disease hypert
> ension     

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.12              49.31               -0.010
         sex |            0.50               0.53               -0.045
  region_nhs |            4.81               4.81               -0.001
paxlovid_c~d |            0.68               0.52                0.338
downs_synd~e |            0.18               0.20               -0.033
solid_cancer |            0.10               0.10               -0.017
haem_disease |            0.48               0.46                0.022
renal_dise~e |            0.34               0.35               -0.024
liver_dise~e |            0.19               0.18                0.024
imid_on_drug |            0.22               0.23               -0.022
immunosupr~n |            0.10               0.10               -0.009
    hiv_aids |            0.19               0.19                0.009
organ_tran~t |            0.32               0.31                0.007
  rare_neuro |            0.57               0.57                0.006
vaccinat~tus |            2.20               2.20                0.000
       imdq5 |            3.03               3.00                0.018
       White |            0.60               0.61               -0.006
   bmi_group |            1.97               1.97               -0.007
    diabetes |            0.10               0.11               -0.018
chronic_ca~e |            0.10               0.10               -0.000
chronic_re~e |            0.10               0.10               -0.001
hypertension |            0.10               0.10               -0.004
----------------------------------------------------------------------


. pbalchk no_drug age sex region_nhs paxlovid_contraindicated downs_syndrome so
> lid_cancer haem_disease renal_disease liver_disease imid_on_drug immunosupres
> sion hiv_aids organ_transplant rare_neuro vaccination_status imdq5 White ///
> bmi_group diabetes chronic_cardiac_disease chronic_respiratory_disease hypert
> ension, ///
> wt(iptw_fulladj2) graph

               Mean in treated   Mean in Untreated   Standardised diff.
----------------------------------------------------------------------
         age |           49.18              49.20               -0.001
         sex |            0.51               0.51                0.002
  region_nhs |            4.81               4.82               -0.004
paxlovid_c~d |            0.64               0.63                0.011
downs_synd~e |            0.19               0.18                0.004
solid_cancer |            0.10               0.10                0.006
haem_disease |            0.47               0.47                0.002
renal_dise~e |            0.35               0.36               -0.038
liver_dise~e |            0.19               0.20               -0.033
imid_on_drug |            0.22               0.22                0.002
immunosupr~n |            0.10               0.10               -0.001
    hiv_aids |            0.19               0.19               -0.004
organ_tran~t |            0.32               0.33               -0.025
  rare_neuro |            0.57               0.57                0.002
vaccinat~tus |            2.20               2.20                0.004
       imdq5 |            3.02               3.02                0.002
       White |            0.60               0.60               -0.001
   bmi_group |            1.97               1.97               -0.006
    diabetes |            0.10               0.10                0.000
chronic_ca~e |            0.10               0.10                0.000
chronic_re~e |            0.10               0.10                0.001
hypertension |            0.10               0.10               -0.002
----------------------------------------------------------------------


. graph export "$projectdir/output/figures/match_fulladj2.svg", as(svg) replace
(note: file /workspace/output/figures/match_fulladj2.svg not found)
(file /workspace/output/figures/match_fulladj2.svg written in SVG format)

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/ps_model.log
  log type:  text
 closed on:  19 Jun 2023, 10:53:10
-------------------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\k1635179\OneDrive - King's College London\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovimab-Paxlovi
> d-Molnupiravir/logs/cleaning_dataset.log
  log type:  text
 opened on:  30 May 2023, 14:11:10

. 
. * import dataset
. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College London\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovimab-
> Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date                               ///
>                                                  covid_test_positive_date2                              ///
>                                                  covid_test_positive_date3                              ///
>                                                  prior_covid_date                                       ///
>                                                  sotrovimab                                                             ///
>                                                  molnupiravir                                                   /// 
>                                                  paxlovid                                                               ///
>                                                  remdesivir                                                             ///
>                                                  casirivimab                                                    ///
>                                                  sotrovimab_not_start                                   ///
>                                                  molnupiravir_not_start                                 ///
>                                                  paxlovid_not_start                                             ///
>                                                  date_treated                                                   ///
>                                                  start_date                                                             ///
>                                                  drugs_do_not_use                                               ///
>                                                  drugs_consider_risk                                    ///
>                                                  last_vaccination_date                                  ///
>                                                  death_date                                                             ///
>                                                  dereg_date                                                     ///
>                                                  bmi_date_measured                                              ///
>                                                  creatinine_ctv3_date                                   ///
>                                                  creatinine_snomed_date                                 ///
>                                                  creatinine_short_snomed_date                   ///
>                                                  covid_discharge_date_primary                   ///
>                                                  any_covid_hosp_discharge                               ///                     
>                                                  ae_diverticulitis_icd                                  ///
>                                                  ae_diverticulitis_snomed                               ///
>                                              ae_diarrhoea_snomed                                        ///
>                                                  ae_taste_snomed                                                ///
>                                                  ae_taste_icd                                                   ///
>                                                  ae_anaphylaxis_icd                                             ///
>                                                  ae_anaphylaxis_snomed                                  ///
>                                                  ae_rheumatoid_arthritis_snomed                 ///
>                                                  ae_rheumatoid_arthritis_icd                    ///
>                                                  ae_sle_ctv                                                             ///
>                                                  ae_sle_icd                                                             ///
>                                                  ae_psoriasis_snomed                                    ///
>                                                  ae_psoriatic_arthritis_snomed                  ///
>                                                  ae_ankylosing_spondylitis_ctv                  ///
>                                                  ae_ibd_snomed                                                  ///
>                                                  rheumatoid_arthritis_nhsd_snomed               ///
>                                                  rheumatoid_arthritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv                                                   ///
>                                                  sle_nhsd_icd10                                                 ///
>                                                  psoriasis_nhsd                                                 ///
>                                                  psoriatic_arthritis_nhsd                               ///
>                                                  ankylosing_spondylitis_nhsd                    ///
>                                                  ibd_ctv                                                                ///
>                                                  all_hosp_date                                                  ///
>                                                  all_hosp_date0                                                 ///
>                                                  all_hosp_date1                                                 ///
>                                                  all_hosp_date2                                                 ///
>                                                  hosp_discharge_date                                    ///
>                                                  hosp_discharge_date0                                   ///
>                                                  hosp_discharge_date1                                   ///
>                                                  hosp_discharge_date2                                   ///
>                                                  covid_hosp_date                                                ///
>                                                  covid_hosp_date_primary                                ///
>                                                  covid_hosp_date0                                               ///
>                                                  covid_hosp_date1                                               ///
>                                                  covid_hosp_date2                                               ///               
>                               
>                                                  covid_discharge_date0                                  ///                       
>                       
>                                                  covid_discharge_date1                                  /// 
>                                                  covid_discharge_date2                                  /// 
>                                                  covid_hosp_date_mabs                                   /// 
>                                                  covid_hosp_date_mabs_not_primary               /// 
>                                                  covid_hosp_date_mabs_day                               ///
>                                                  died_date_ons                                                  ///
>                                                  died_ons_covid {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,472 missing values generated)
(864 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

------------------------------------------------------------------------------------------------------------------------------------
covid_test_positive_date                                                                                                 (unlabeled)
------------------------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,999/50,000

                  Mean: 22892.2 = 04sep2022(+ 5 hours)
             Std. dev.:  154.26
           Percentiles:       10%        25%        50%        75%        90%
                            22679      22758      22893      23026      23107
                        03feb2022  23apr2022  05sep2022  16jan2023  07apr2023

------------------------------------------------------------------------------------------------------------------------------------
date_treated                                                                                                             (unlabeled)
------------------------------------------------------------------------------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 8,472/50,000

                  Mean: 22836.2 = 10jul2022(+ 4 hours)
             Std. dev.: 144.729
           Percentiles:       10%        25%        50%        75%        90%
                            22661      22711      22812      22947      23056
                        16jan2022  07mar2022  16jun2022  29oct2022  15feb2023

. count if date_treated!=. //number with covid therapeutic
  41,528

. count if covid_test_positive_date!=. //number positive covid test
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number positive covid test in control group
  7,608

. 
end of do-file

. preserve

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. ****************************
. *       EXPOSURE                *
. ****************************
. ** removing individuals who did not start therapy
. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         gen `var'_start = 1 if `var'!=. & `var'_not_start==.
  4.         replace `var'_start = 0 if `var'!=. & `var'_not_start!=.
  5.         tab `var'_start, m  //number on treatment and started
  6. }
sotrovimab
(35,150 missing values generated)
(150 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        150        0.30        0.30
          1 |     14,850       29.70       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
(35,140 missing values generated)
(140 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        140        0.28        0.28
          1 |     14,860       29.72       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
(35,159 missing values generated)
(159 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        159        0.32        0.32
          1 |     14,841       29.68       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,729 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(8,215 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_start==1
(8,244 real changes made)

. replace drug=4 if (remdesivir==date_treated)  | (casirivimab==date_treated)
(25,095 real changes made)

. replace drug=0 if drug==.
(231 real changes made)

. count if drug==4
  25,095

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,397 missing values generated)
(865 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. ** removing individuals who did not start therapy
. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         gen `var'_start = 1 if `var'!=. & `var'_not_start==.
  4.         replace `var'_start = 0 if `var'!=. & `var'_not_star
> t!=.
  5.         tab `var'_start, m  //number on treatment and starte
> d
  6. }
sotrovimab
(35,156 missing values generated)
(156 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        156        0.31        0.31
          1 |     14,844       29.69       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
(35,189 missing values generated)
(189 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        189        0.38        0.38
          1 |     14,811       29.62       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
(35,144 missing values generated)
(144 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        144        0.29        0.29
          1 |     14,856       29.71       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. restore

. preserve

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         gen `var'_start = 1 if `var'!=. & `var'_not_start==.
  5.         replace `var'_start = 0 if `var'!=. & `var'_not_star
> t!=.
  6.         tab `var'_start, m  //number on treatment and starte
> d
  7. }
sotrovimab
  15,000
(35,150 missing values generated)
(150 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        150        0.30        0.30
          1 |     14,850       29.70       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
(35,140 missing values generated)
(140 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        140        0.28        0.28
          1 |     14,860       29.72       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
(35,159 missing values generated)
(159 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        159        0.32        0.32
          1 |     14,841       29.68       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,729 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(8,215 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(8,244 real changes made)

. replace drug=4 if (remdesivir==date_treated)  | (casirivimab==d
> ate_treated)
(25,095 real changes made)

. replace drug=5 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(78 real changes made)

. replace drug=6 if paxlovid==date_treated & paxlovid_start==0 
(79 real changes made)

. replace drug=7 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(74 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,249       16.50       16.50
          2 |      8,193       16.39       32.88
          3 |      8,232       16.46       49.35
          4 |     25,095       50.19       99.54
          5 |         78        0.16       99.69
          6 |         79        0.16       99.85
          7 |         74        0.15      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,249       16.50       16.50
          2 |      8,193       16.39       32.88
          3 |      8,232       16.46       49.35
          4 |     25,095       50.19       99.54
          5 |         78        0.16       99.69
          6 |         79        0.16       99.85
          7 |         74        0.15      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. restore

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         gen `var'_start = 1 if `var'!=. & `var'_not_start==.
  5.         replace `var'_start = 0 if `var'!=. & `var'_not_star
> t!=.
  6.         tab `var'_start, m  //number on treatment and starte
> d
  7. }
sotrovimab
  15,000
(35,150 missing values generated)
(150 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        150        0.30        0.30
          1 |     14,850       29.70       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
(35,140 missing values generated)
(140 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        140        0.28        0.28
          1 |     14,860       29.72       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
(35,159 missing values generated)
(159 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        159        0.32        0.32
          1 |     14,841       29.68       30.00
          . |     35,000       70.00      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,729 missing values generated)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,271      100.00      100.00
------------+-----------------------------------
      Total |      8,271      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(78 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,271       99.07       99.07
          4 |         78        0.93      100.00
------------+-----------------------------------
      Total |      8,349      100.00

. restore
nothing to restore
r(622);

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,397 missing values generated)
(865 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.3 = 04sep2022(+ 8 hours)
             Std. dev.:  154.96
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22758      22892      2302
> 6      23108
                        02feb2022  23apr2022  04sep2022  16jan202
> 3  08apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 8,39
> 7/50,000

                  Mean:   22836 = 10jul2022(+ 0 hours)
             Std. dev.: 144.943
           Percentiles:       10%        25%        50%        75
> %        90%
                            22660      22710      22812      2294
> 5      23057
                        15jan2022  06mar2022  16jun2022  27oct202
> 2  16feb2023

. count if date_treated!=. //number with covid therapeutic
  41,603

. count if covid_test_positive_date!=. //number positive covid te
> st
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  7,532

. 
end of do-file

. preserve

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         gen `var'_start = 1 if `var'==date_treated & `var'_n
> ot_start==.
  5.         replace `var'_start = 0 if `var'==date_treated & `va
> r'_not_start!=.
  6.         tab `var'_start, m  //number on treatment and starte
> d
  7. }
sotrovimab
  15,000
(33,442 missing values generated)
(164 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        164        0.33        0.33
          1 |     16,558       33.12       33.44
          . |     33,278       66.56      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
(33,489 missing values generated)
(181 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        181        0.36        0.36
          1 |     16,511       33.02       33.38
          . |     33,308       66.62      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
(33,429 missing values generated)
(158 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        158        0.32        0.32
          1 |     16,571       33.14       33.46
          . |     33,271       66.54      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(33,442 missing values generated)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     16,558      100.00      100.00
------------+-----------------------------------
      Total |     16,558      100.00

. restore

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & & `var'
> !=. & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment and starte
> d
  8. }
sotrovimab
  15,000
  8,325
date_treated& invalid name
r(198);

end of do-file

r(198);

. restore
nothing to restore
r(622);

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. ** removing individuals who did not start therapy
. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & `var'!=
> . & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment and starte
> d
  8. }
sotrovimab
  15,000
  8,325
(41,760 missing values generated)
(85 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         85        0.17        0.17
          1 |      8,240       16.48       16.65
          . |     41,675       83.35      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
  8,295
(41,806 missing values generated)
(101 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        101        0.20        0.20
          1 |      8,194       16.39       16.59
          . |     41,705       83.41      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
  8,332
(41,750 missing values generated)
(82 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         82        0.16        0.16
          1 |      8,250       16.50       16.66
          . |     41,668       83.34      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,760 missing values generated)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,240      100.00      100.00
------------+-----------------------------------
      Total |      8,240      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(8,250 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(8,194 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(85 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(82 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(101 real changes made)

. replace drug=7 if (remdesivir==date_treated)  | (casirivimab==d
> ate_treated)
(25,089 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,223       16.45       16.45
          2 |      8,239       16.48       32.92
          3 |      8,182       16.36       49.29
          4 |         84        0.17       49.46
          5 |         82        0.16       49.62
          6 |        101        0.20       49.82
          7 |     25,089       50.18      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. restore
nothing to restore
r(622);

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. * import dataset
. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,397 missing values generated)
(865 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.3 = 04sep2022(+ 8 hours)
             Std. dev.:  154.96
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22758      22892      2302
> 6      23108
                        02feb2022  23apr2022  04sep2022  16jan202
> 3  08apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 8,39
> 7/50,000

                  Mean:   22836 = 10jul2022(+ 0 hours)
             Std. dev.: 144.943
           Percentiles:       10%        25%        50%        75
> %        90%
                            22660      22710      22812      2294
> 5      23057
                        15jan2022  06mar2022  16jun2022  27oct202
> 2  16feb2023

. count if date_treated!=. //number with covid therapeutic
  41,603

. count if covid_test_positive_date!=. //number positive covid te
> st
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  7,532

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. * import dataset
. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,397 missing values generated)
(865 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.3 = 04sep2022(+ 8 hours)
             Std. dev.:  154.96
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22758      22892      2302
> 6      23108
                        02feb2022  23apr2022  04sep2022  16jan202
> 3  08apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 8,39
> 7/50,000

                  Mean:   22836 = 10jul2022(+ 0 hours)
             Std. dev.: 144.943
           Percentiles:       10%        25%        50%        75
> %        90%
                            22660      22710      22812      2294
> 5      23057
                        15jan2022  06mar2022  16jun2022  27oct202
> 2  16feb2023

. count if date_treated!=. //number with covid therapeutic
  41,603

. count if covid_test_positive_date!=. //number positive covid te
> st
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  7,532

. 
end of do-file

. preserve

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & `var'!=
> . & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment, first dru
> g given, and drug was started
  8. }
sotrovimab
  15,000
  8,325
(41,760 missing values generated)
(85 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         85        0.17        0.17
          1 |      8,240       16.48       16.65
          . |     41,675       83.35      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
  8,295
(41,806 missing values generated)
(101 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        101        0.20        0.20
          1 |      8,194       16.39       16.59
          . |     41,705       83.41      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
  8,332
(41,750 missing values generated)
(82 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         82        0.16        0.16
          1 |      8,250       16.50       16.66
          . |     41,668       83.34      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,760 missing values generated)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,240      100.00      100.00
------------+-----------------------------------
      Total |      8,240      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(8,250 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,237       49.96       49.96
          2 |      8,250       50.04      100.00
------------+-----------------------------------
      Total |     16,487      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(8,194 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,232       33.37       33.37
          2 |      8,245       33.42       66.79
          3 |      8,194       33.21      100.00
------------+-----------------------------------
      Total |     24,671      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(85 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,232       33.25       33.25
          2 |      8,245       33.31       66.56
          3 |      8,194       33.10       99.66
          4 |         85        0.34      100.00
------------+-----------------------------------
      Total |     24,756      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(82 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,232       33.14       33.14
          2 |      8,245       33.20       66.34
          3 |      8,194       32.99       99.33
          4 |         85        0.34       99.67
          5 |         82        0.33      100.00
------------+-----------------------------------
      Total |     24,838      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(101 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,232       33.01       33.01
          2 |      8,245       33.06       66.07
          3 |      8,194       32.86       98.93
          4 |         85        0.34       99.27
          5 |         82        0.33       99.60
          6 |        101        0.40      100.00
------------+-----------------------------------
      Total |     24,939      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=7 if (remdesivir==date_treated)  | (casirivimab==d
> ate_treated)
(25,089 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,223       16.45       16.45
          2 |      8,239       16.48       32.92
          3 |      8,182       16.36       49.29
          4 |         84        0.17       49.46
          5 |         82        0.16       49.62
          6 |        101        0.20       49.82
          7 |     25,089       50.18      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. tab drug, m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,223       16.45       16.45
          2 |      8,239       16.48       32.92
          3 |      8,182       16.36       49.29
          4 |         84        0.17       49.46
          5 |         82        0.16       49.62
          6 |        101        0.20       49.82
          7 |     25,089       50.18      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=0 if drug==.
(0 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(35,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(8,361 missing values generated)
(823 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.5 = 04sep2022(+ 11 hours)
             Std. dev.: 154.573
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22759      22891      2302
> 7      23107
                        02feb2022  24apr2022  03sep2022  17jan202
> 3  07apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 8,36
> 1/50,000

                  Mean: 22836.3 = 10jul2022(+ 7 hours)
             Std. dev.: 144.363
           Percentiles:       10%        25%        50%        75
> %        90%
                            22662      22712      22811      2294
> 4      23057
                        17jan2022  08mar2022  15jun2022  26oct202
> 2  16feb2023

. count if date_treated!=. //number with covid therapeutic
  41,639

. count if covid_test_positive_date!=. //number positive covid te
> st
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  7,538

. 
end of do-file

. preserve
already preserved
r(621);

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & `var'!=
> . & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment, first dru
> g given, and drug was started
  8. }
sotrovimab
  15,000
  8,421
(41,663 missing values generated)
(84 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         84        0.17        0.17
          1 |      8,337       16.67       16.84
          . |     41,579       83.16      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  15,000
  8,246
(41,848 missing values generated)
(94 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         94        0.19        0.19
          1 |      8,152       16.30       16.49
          . |     41,754       83.51      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  15,000
  8,379
(41,711 missing values generated)
(90 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         90        0.18        0.18
          1 |      8,289       16.58       16.76
          . |     41,621       83.24      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(41,663 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(8,289 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(8,152 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(84 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(90 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(94 real changes made)

. replace drug=7 if (remdesivir==date_treated)  | (casirivimab==d
> ate_treated)
(25,016 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      8,306       16.61       16.61
          2 |      8,272       16.54       33.16
          3 |      8,138       16.28       49.43
          4 |         84        0.17       49.60
          5 |         90        0.18       49.78
          6 |         94        0.19       49.97
          7 |     25,016       50.03      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(29,519 missing values generated)
(2,888 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.3 = 04sep2022(+ 8 hours)
             Std. dev.: 154.434
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22759      22893      2302
> 5      23107
                        02feb2022  24apr2022  05sep2022  15jan202
> 3  07apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 29,5
> 19/50,000

                  Mean: 22876.9 = 19aug2022(+ 22 hours)
             Std. dev.: 152.262
           Percentiles:       10%        25%        50%        75
> %        90%
                            22673      22744      22867      2300
> 5      23097
                        28jan2022  09apr2022  10aug2022  26dec202
> 2  28mar2023

. count if date_treated!=. //number with covid therapeutic
  20,481

. count if covid_test_positive_date!=. //number positive covid te
> st
  45,001

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  26,631

. 
. ****************************
. *       EXPOSURE                *
. ****************************
. ** removing individuals who did not start therapy
. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & `var'!=
> . & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment, first dru
> g given, and drug was started
  8. }
sotrovimab
  5,000
  4,034
(46,014 missing values generated)
(48 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         48        0.10        0.10
          1 |      3,986        7.97        8.07
          . |     45,966       91.93      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  5,000
  4,081
(45,956 missing values generated)
(37 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         37        0.07        0.07
          1 |      4,044        8.09        8.16
          . |     45,919       91.84      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  5,000
  4,105
(45,923 missing values generated)
(28 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         28        0.06        0.06
          1 |      4,077        8.15        8.21
          . |     45,895       91.79      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(46,014 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(4,077 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(4,044 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(48 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(28 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(37 real changes made)

. replace drug=7 if (remdesivir==date_treated)  | (casirivimab==d
> ate_treated)
(37,788 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,981        7.96        7.96
          2 |      4,075        8.15       16.11
          3 |      4,043        8.09       24.20
          4 |         48        0.10       24.29
          5 |         28        0.06       24.35
          6 |         37        0.07       24.42
          7 |     37,788       75.58      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. count if remdesivir==date_treated & remdesivir!=. & date_treate
> d!=.
  4,172

. drop drug

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(46,014 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(4,077 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(4,044 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(48 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(28 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(37 real changes made)

. replace drug=7 if (remdesivir==date_treated&remdesivir!=.& date
> _treated!=)|(casirivimab==date_treated&casirivimab!=.& date_tre
> ated!=)
invalid syntax
r(198);

end of do-file

r(198);

. drop drug

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(46,014 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(4,077 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(4,044 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(48 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(28 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(37 real changes made)

. replace drug=7 if remdesivir==date_treated&remdesivir!=.&date_t
> reated!=.
(4,172 real changes made)

. replace drug=8 if casirivimab==date_treated&casirivimab!=.&date
> _treated!=.
(4,097 real changes made)

. 
end of do-file

. tab drug

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,981       19.44       19.44
          2 |      4,075       19.90       39.33
          3 |      4,043       19.74       59.07
          4 |         48        0.23       59.31
          5 |         28        0.14       59.45
          6 |         37        0.18       59.63
          7 |      4,172       20.37       80.00
          8 |      4,097       20.00      100.00
------------+-----------------------------------
      Total |     20,481      100.00

. tab drug,m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      3,981        7.96        7.96
          2 |      4,075        8.15       16.11
          3 |      4,043        8.09       24.20
          4 |         48        0.10       24.29
          5 |         28        0.06       24.35
          6 |         37        0.07       24.42
          7 |      4,172        8.34       32.77
          8 |      4,097        8.19       40.96
          . |     29,519       59.04      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace drug=0 if drug==.
(29,519 real changes made)

. 
end of do-file

. tab drug,m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,519       59.04       59.04
          1 |      3,981        7.96       67.00
          2 |      4,075        8.15       75.15
          3 |      4,043        8.09       83.24
          4 |         48        0.10       83.33
          5 |         28        0.06       83.39
          6 |         37        0.07       83.46
          7 |      4,172        8.34       91.81
          8 |      4,097        8.19      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. tab drug, m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,519       59.04       59.04
          1 |      3,981        7.96       67.00
          2 |      4,075        8.15       75.15
          3 |      4,043        8.09       83.24
          4 |         48        0.10       83.33
          5 |         28        0.06       83.39
          6 |         37        0.07       83.46
          7 |      4,172        8.34       91.81
          8 |      4,097        8.19      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. drop if drug>3
(8,382 observations deleted)

. 
end of do-file

. tab drug,m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,519       70.93       70.93
          1 |      3,981        9.57       80.49
          2 |      4,075        9.79       90.29
          3 |      4,043        9.71      100.00
------------+-----------------------------------
      Total |     41,618      100.00

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. label define drug 0 "control" 1 "sotrovimab" 2 "paxlovid" 3"mol
> nupiravir", replace

. label values drug drug

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. bys drug: count if date_treated==. 

-----------------------------------------------------------------
-> drug = control
  29,519
-----------------------------------------------------------------
-> drug = sotrovimab
  0
-----------------------------------------------------------------
-> drug = paxlovid
  0
-----------------------------------------------------------------
-> drug = molnupiravir
  0

. replace date_treated = covid_test_positive_date if drug==0
(26,631 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. count if date_treated!=. //number with covid therapeutic
  38,730

. count if covid_test_positive_date!=. //number positive covid te
> st
  37,453

. count if date_treated==. & covid_test_positive_date!=. //number
>  positive covid test in control group
  0

. 
. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. bys drug: count if date_treated==.

-----------------------------------------------------------------
-> drug = control
  2,888
-----------------------------------------------------------------
-> drug = sotrovimab
  0
-----------------------------------------------------------------
-> drug = paxlovid
  0
-----------------------------------------------------------------
-> drug = molnupiravir
  0

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. bys drug: count if covid_test_positive_date==.

-----------------------------------------------------------------
-> drug = control
  2,888
-----------------------------------------------------------------
-> drug = sotrovimab
  425
-----------------------------------------------------------------
-> drug = paxlovid
  401
-----------------------------------------------------------------
-> drug = molnupiravir
  451

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. count if covid_test_positive_date==. & drug==0
  2,888

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. bys drug: count if covid_test_positive_date==. //should be 0

-----------------------------------------------------------------
-> drug = control
  2,888
-----------------------------------------------------------------
-> drug = sotrovimab
  425
-----------------------------------------------------------------
-> drug = paxlovid
  401
-----------------------------------------------------------------
-> drug = molnupiravir
  451

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. bys drug: count if covid_test_positive_date!=. //should be 0

-----------------------------------------------------------------
-> drug = control
  26,631
-----------------------------------------------------------------
-> drug = sotrovimab
  3,556
-----------------------------------------------------------------
-> drug = paxlovid
  3,674
-----------------------------------------------------------------
-> drug = molnupiravir
  3,592

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. replace date_treated = covid_test_positive_date if drug==0
(0 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. * import dataset
. import delimited "$projectdir/output/input.csv", clear
(encoding automatically selected: ISO-8859-1)
(165 vars, 50,000 obs)

. 
. *Set Ado file path
. adopath + "$projectdir/analysis/ado"
  [1]  (BASE)      "C:\Program Files\Stata17\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata17\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\users\PUBLIC\documents/"
  [5]  (PLUS)      "C:\users\PUBLIC\documents/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "C:\Users\k1635179\OneDrive - King's College L
> ondon\Katie\OpenSafely\Safety mAB and antivirals\Safety-Sotrovi
> mab-Paxlovid-Molnupiravir/analysis/ado"

. 
. //describe
. //codebook
. 
. *  Convert strings to dates  *
. foreach var of varlist   covid_test_positive_date              
>                  ///
>                                                  covid_test_pos
> itive_date2                              ///
>                                                  covid_test_pos
> itive_date3                              ///
>                                                  prior_covid_da
> te                                       ///
>                                                  sotrovimab    
>                                                          ///
>                                                  molnupiravir  
>                                                  /// 
>                                                  paxlovid      
>                                                          ///
>                                                  remdesivir    
>                                                          ///
>                                                  casirivimab   
>                                                  ///
>                                                  sotrovimab_not
> _start                                   ///
>                                                  molnupiravir_n
> ot_start                                 ///
>                                                  paxlovid_not_s
> tart                                             ///
>                                                  date_treated  
>                                                  ///
>                                                  start_date    
>                                                          ///
>                                                  drugs_do_not_u
> se                                               ///
>                                                  drugs_consider
> _risk                                    ///
>                                                  last_vaccinati
> on_date                                  ///
>                                                  death_date    
>                                                          ///
>                                                  dereg_date    
>                                                  ///
>                                                  bmi_date_measu
> red                                              ///
>                                                  creatinine_ctv
> 3_date                                   ///
>                                                  creatinine_sno
> med_date                                 ///
>                                                  creatinine_sho
> rt_snomed_date                   ///
>                                                  covid_discharg
> e_date_primary                   ///
>                                                  any_covid_hosp
> _discharge                               ///                   
>   
>                                                  ae_diverticuli
> tis_icd                                  ///
>                                                  ae_diverticuli
> tis_snomed                               ///
>                                              ae_diarrhoea_snome
> d                                        ///
>                                                  ae_taste_snome
> d                                                ///
>                                                  ae_taste_icd  
>                                                  ///
>                                                  ae_anaphylaxis
> _icd                                             ///
>                                                  ae_anaphylaxis
> _snomed                                  ///
>                                                  ae_rheumatoid_
> arthritis_snomed                 ///
>                                                  ae_rheumatoid_
> arthritis_icd                    ///
>                                                  ae_sle_ctv    
>                                                          ///
>                                                  ae_sle_icd    
>                                                          ///
>                                                  ae_psoriasis_s
> nomed                                    ///
>                                                  ae_psoriatic_a
> rthritis_snomed                  ///
>                                                  ae_ankylosing_
> spondylitis_ctv                  ///
>                                                  ae_ibd_snomed 
>                                                  ///
>                                                  rheumatoid_art
> hritis_nhsd_snomed               ///
>                                                  rheumatoid_art
> hritis_nhsd_icd10                ///
>                                                  sle_nhsd_ctv  
>                                                  ///
>                                                  sle_nhsd_icd10
>                                                  ///
>                                                  psoriasis_nhsd
>                                                  ///
>                                                  psoriatic_arth
> ritis_nhsd                               ///
>                                                  ankylosing_spo
> ndylitis_nhsd                    ///
>                                                  ibd_ctv       
>                                                          ///
>                                                  all_hosp_date 
>                                                  ///
>                                                  all_hosp_date0
>                                                  ///
>                                                  all_hosp_date1
>                                                  ///
>                                                  all_hosp_date2
>                                                  ///
>                                                  hosp_discharge
> _date                                    ///
>                                                  hosp_discharge
> _date0                                   ///
>                                                  hosp_discharge
> _date1                                   ///
>                                                  hosp_discharge
> _date2                                   ///
>                                                  covid_hosp_dat
> e                                                ///
>                                                  covid_hosp_dat
> e_primary                                ///
>                                                  covid_hosp_dat
> e0                                               ///
>                                                  covid_hosp_dat
> e1                                               ///
>                                                  covid_hosp_dat
> e2                                               ///           
>                                   
>                                                  covid_discharg
> e_date0                                  ///                   
>                           
>                                                  covid_discharg
> e_date1                                  /// 
>                                                  covid_discharg
> e_date2                                  /// 
>                                                  covid_hosp_dat
> e_mabs                                   /// 
>                                                  covid_hosp_dat
> e_mabs_not_primary               /// 
>                                                  covid_hosp_dat
> e_mabs_day                               ///
>                                                  died_date_ons 
>                                                  ///
>                                                  died_ons_covid
>  {                                        
  2.         capture confirm string variable `var'
  3.         if _rc==0 {
  4.         rename `var' a
  5.         gen `var' = date(a, "YMD")
  6.         drop a
  7.         format %td `var'
  8.  }
  9. }
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(4,999 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(49,500 missing values generated)
(29,519 missing values generated)
(2,888 missing values generated)
(47,500 missing values generated)
(47,500 missing values generated)
(2,500 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(2,500 missing values generated)
(25,000 missing values generated)
(25,000 missing values generated)
(45,000 missing values generated)
(47,500 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(40,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(45,000 missing values generated)
(20,000 missing values generated)
(20,000 missing values generated)

. 
. *check hosp/death event date range*
. codebook covid_test_positive_date date_treated 

-----------------------------------------------------------------
covid_test_positive_date                              (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22626,23160]                 Units: 1
       Or equivalently: [12dec2021,30may2023]         Units: days
         Unique values: 535                       Missing .: 4,99
> 9/50,000

                  Mean: 22892.3 = 04sep2022(+ 8 hours)
             Std. dev.: 154.434
           Percentiles:       10%        25%        50%        75
> %        90%
                            22678      22759      22893      2302
> 5      23107
                        02feb2022  24apr2022  05sep2022  15jan202
> 3  07apr2023

-----------------------------------------------------------------
date_treated                                          (unlabeled)
-----------------------------------------------------------------

                  Type: Numeric daily date (float)

                 Range: [22631,23160]                 Units: 1
       Or equivalently: [17dec2021,30may2023]         Units: days
         Unique values: 530                       Missing .: 29,5
> 19/50,000

                  Mean: 22876.9 = 19aug2022(+ 22 hours)
             Std. dev.: 152.262
           Percentiles:       10%        25%        50%        75
> %        90%
                            22673      22744      22867      2300
> 5      23097
                        28jan2022  09apr2022  10aug2022  26dec202
> 2  28mar2023

. 
. ****************************
. *       EXPOSURE                *
. ****************************
. ** removing individuals who did not start therapy
. foreach var of varlist sotrovimab molnupiravir paxlovid {
  2.     display "`var'"
  3.         count if `var'!=.
  4.         count if `var'==date_treated & `var'!=. & date_treat
> ed!=.
  5.         gen `var'_start = 1 if `var'==date_treated & `var'!=
> . & date_treated!=. & `var'_not_start==.
  6.         replace `var'_start = 0 if `var'==date_treated & `va
> r'!=. & date_treated!=. & `var'_not_start!=.
  7.         tab `var'_start, m  //number on treatment, first dru
> g given, and drug was started
  8. }
sotrovimab
  5,000
  4,034
(46,014 missing values generated)
(48 real changes made)

sotrovimab_ |
      start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         48        0.10        0.10
          1 |      3,986        7.97        8.07
          . |     45,966       91.93      100.00
------------+-----------------------------------
      Total |     50,000      100.00
molnupiravir
  5,000
  4,081
(45,956 missing values generated)
(37 real changes made)

molnupiravi |
    r_start |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         37        0.07        0.07
          1 |      4,044        8.09        8.16
          . |     45,919       91.84      100.00
------------+-----------------------------------
      Total |     50,000      100.00
paxlovid
  5,000
  4,105
(45,923 missing values generated)
(28 real changes made)

paxlovid_st |
        art |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         28        0.06        0.06
          1 |      4,077        8.15        8.21
          . |     45,895       91.79      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. gen drug=1 if sotrovimab==date_treated & sotrovimab_start==1 
(46,014 missing values generated)

. replace drug=2 if paxlovid==date_treated & paxlovid_start==1
(4,077 real changes made)

. replace drug=3 if molnupiravir==date_treated & molnupiravir_sta
> rt==1
(4,044 real changes made)

. replace drug=4 if sotrovimab==date_treated & sotrovimab_start==
> 0 
(48 real changes made)

. replace drug=5 if paxlovid==date_treated & paxlovid_start==0 
(28 real changes made)

. replace drug=6 if molnupiravir==date_treated & molnupiravir_sta
> rt==0 
(37 real changes made)

. replace drug=7 if remdesivir==date_treated&remdesivir!=.&date_t
> reated!=.
(4,172 real changes made)

. replace drug=8 if casirivimab==date_treated&casirivimab!=.&date
> _treated!=.
(4,097 real changes made)

. replace drug=0 if drug==.
(29,519 real changes made)

. tab drug, m

       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,519       59.04       59.04
          1 |      3,981        7.96       67.00
          2 |      4,075        8.15       75.15
          3 |      4,043        8.09       83.24
          4 |         48        0.10       83.33
          5 |         28        0.06       83.39
          6 |         37        0.07       83.46
          7 |      4,172        8.34       91.81
          8 |      4,097        8.19      100.00
------------+-----------------------------------
      Total |     50,000      100.00

. drop if drug>3
(8,382 observations deleted)

. label define drug 0 "control" 1 "sotrovimab" 2 "paxlovid" 3"mol
> nupiravir", replace

. label values drug drug

. ** gen start date for control group - just take from covid test
>  date
. bys drug: count if date_treated==.

-----------------------------------------------------------------
-> drug = control
  29,519
-----------------------------------------------------------------
-> drug = sotrovimab
  0
-----------------------------------------------------------------
-> drug = paxlovid
  0
-----------------------------------------------------------------
-> drug = molnupiravir
  0

. bys drug: count if covid_test_positive_date==. //should be 0 - 
> if is not 0, then mistake with study def

-----------------------------------------------------------------
-> drug = control
  2,888
-----------------------------------------------------------------
-> drug = sotrovimab
  425
-----------------------------------------------------------------
-> drug = paxlovid
  401
-----------------------------------------------------------------
-> drug = molnupiravir
  451

. replace date_treated = covid_test_positive_date if drug==0
(26,631 real changes made)

. 
end of do-file

. do "C:\Users\k1635179\AppData\Local\Temp\STD1304_000000.tmp"

. gen study_end_date=mdy(06,01,2023)

. 
end of do-file

